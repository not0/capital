---
import fs from 'fs';
import path from 'path';
import comics from '../../data/comics.json';

export async function getStaticPaths() {
  return comics.map(comic => ({
    params: { id: String(comic.id) }
  }));
}

const { id } = Astro.params;
const comic = comics.find(c => String(c.id) === id);

const pagesDir = path.resolve('./public/assets/comics/', id, 'pages');
let pages = [];
try {
  pages = fs.readdirSync(pagesDir).sort();
} catch (err) {
  console.error(`Error reading images for comic ID ${id}:`, err);
}
---

<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>{comic.title} {id}</title>
  </head>
  <body>
  <section>
      <h1>{comic.title}</h1>
      <p>{comic.description}</p>
    </section>

    <section>
      {pages.map(name => (
        <img
          src={`${import.meta.env.BASE_URL}/assets/comics/${id}/pages/${name}`}
          alt={name}
          loading="lazy"
        />
      ))}
    </section>
  </body>
</html>
