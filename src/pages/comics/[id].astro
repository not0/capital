---
import fs from "fs";
import path from "path";
import BaseLayout from "../../layouts/BaseLayout.astro";
import comics from "../../data/comics.json";

export async function getStaticPaths() {
  return comics.map((comic) => ({
    params: { id: String(comic.id) },
  }));
}

const { id } = Astro.params;
const comic = comics.find((c) => String(c.id) === id);

const pagesDir = path.resolve("./public/assets/comics/", id, "pages");
let pages = [];
try {
  pages = fs.readdirSync(pagesDir).sort();
} catch (err) {
  console.error(`Error reading images for comic ID ${id}:`, err);
}

const base = import.meta.env.BASE_URL;
---

<BaseLayout title={`${comic.title}`}>
  <section class="section">
    <div class="container has-text-centered">
      <h1 class="title is-3">{comic.title}</h1>
      <p class="subtitle is-6">{comic.description}</p>
    </div>
  </section>

  <section class="section" style="padding-top: 0;">
    <div class="container" style="max-width: 800px; margin: auto;">
      {
        pages.map((name) => (
          <img
            src={`${base}/assets/comics/${id}/pages/${name}`}
            alt={name}
            loading="lazy"
            style="width: 100%; margin-bottom: 1.5rem;"
          />
        ))
      }
    </div>
  </section>
</BaseLayout>
